diff --git a/index.js b/index.js
index 010875b..9bc881d 100644
--- a/index.js
+++ b/index.js
@@ -51,6 +51,8 @@ exports.bundle = function (opts) {
     var req = opts.require || [];
     if (!Array.isArray(req)) req = [req];
     
+    console.log(req)
+    
     var src = fs.readFileSync(__dirname + '/wrappers/prelude.js', 'utf8')
         + fs.readFileSync(__dirname + '/wrappers/node_compat.js', 'utf8')
         + (shim ? source.modules('es5-shim')['es5-shim'] : '')
@@ -132,6 +134,7 @@ var builtins = fs.readdirSync(__dirname + '/builtins')
 ;
 
 exports.wrap = function (libname, opts) {
+    console.log(libname + " " + JSON.stringify(opts))
     if (!opts) opts = {};
     if (!opts.filename) opts.filename = libname;
     
@@ -149,7 +152,6 @@ exports.wrap = function (libname, opts) {
     if (opts.main && !opts.main.match(/^\//)) {
         opts.main = opts.base + '/' + opts.main;
     }
-    
     if (Array.isArray(libname)) {
         var reqs = opts.required || [];
         
@@ -205,6 +207,8 @@ exports.wrap = function (libname, opts) {
         };
     }
     else if (libname.match(/\//)) {
+      console.log("libname relative\n");
+      
         var resolved = require.resolve(libname);
         var body = fs.readFileSync(resolved, 'utf8');
         
@@ -252,6 +256,7 @@ exports.wrap = function (libname, opts) {
                 ).replace(/\/\.\//g, '/');
             }
             
+            console.log(p.base);
             return {
                 'package.json' : pkg,
                 dependencies : pkg.browserify.require || [],
@@ -299,6 +304,7 @@ exports.wrap = function (libname, opts) {
 
 var find = require('findit');
 exports.wrapDir = function (base, opts) {
+    console.log("wrapDir " + base +  " " + JSON.stringify(opts));
     if (!opts) opts = {};
     
     var pkg = path.existsSync(base + '/package.json')
@@ -335,8 +341,12 @@ exports.wrapDir = function (base, opts) {
             if (!libname.match(/^\.\//)) libname = './' + libname;
             
             var pkgname = main && (
-                unext(main) === file || unext(main) === libname
+                unext(main) === unext(file) || unext(main) === libname
             ) ? '.' : libname;
+            console.log(unext(main) === file);
+            console.log(unext(main) === libname);
+            console.log(unext(main)  + " " + file + " " + libname);
+            console.log("pkg " + pkgname);
             
             return exports.wrap(pkgname, {
                 filename : file,
